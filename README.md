# ç°¡ä»‹: 

æ­¤ç¨‹å¼æ¡†æ¶çš„ç”¨é€”æ˜¯å¹«åŠ©å¤šä»»å‹™å¯¦é©—çš„å”ä½œèˆ‡é–‹ç™¼ï¼Œæä¾›äº†å¯¦é©—çš„è¨“ç·´ã€æ¸¬è©¦ã€Debugã€å‰è™•ç†ç”¨çš„å…±ç”¨æ¨¡çµ„ï¼Œä¸¦ä¸”æ”¯æ´Checkpointï¼Œè®“æ¯æ¬¡å¯¦é©—ç”¢ç”Ÿçš„æœ€ä½³æ¨¡å‹å¯ä»¥è¢«å„²å­˜ä»¥ä¾›æ¸¬è©¦ä½¿ç”¨ï¼Œä¹Ÿæä¾›loggingçš„æ©Ÿåˆ¶ï¼Œä»¥è®“è¨“ç·´éç¨‹ä¸­çš„æ¨¡å‹çš„æˆæ•ˆå¯ä»¥ç”¨Tensorboardä¾†éš¨æ™‚æª¢è¦–ã€‚

æ–¼æ¯æ¬¡å¯¦é©—ï¼Œæ ¹æ“šæˆ‘å€‘æ‰€åˆ¶å®šçš„è¦ç¯„å‰µç«‹ä¸€å€‹å…¨æ–°çš„å¯¦é©—è¨­å®šè³‡æ–™å¤¾ï¼Œåœ¨å…¶ä¸­å®šç¾©æ¨¡å‹ã€æ¨¡å‹åƒæ•¸ã€å„ä»»å‹™è¡¡é‡æŒ‡æ¨™ã€è³‡æ–™å‰è™•ç†æ–¹æ³•ï¼Œå³å¯èˆ‡æˆ‘å€‘çš„å¯¦é©—å…±ç”¨æ¨¡çµ„é€²è¡Œä¸²æ¥æ•´åˆï¼Œè®“æ¯ä¸€æ¬¡çš„å¯¦é©—éƒ½å¯ä»¥è¢«ç°¡æ˜“åœ°è¤‡è£½ã€è¡¡é‡ã€èª¿æ•´ã€‚

ä»¥ä¸‹å°‡é€²ä¸€æ­¥ä»‹ç´¹æ­¤æ¡†æ¶çš„ 1. [è³‡æ–™å¤¾æ¶æ§‹](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E8%B3%87%E6%96%99%E5%A4%BE%E6%9E%B6%E6%A7%8B) 2. [å¯¦é©—åŸ·è¡Œæ–¹æ³•](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E5%AF%A6%E9%A9%97%E5%9F%B7%E8%A1%8C%E6%96%B9%E6%B3%95
) 3. [ç¯„ä¾‹æª”èªªæ˜](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E7%AF%84%E4%BE%8B%E6%AA%94%E8%AA%AA%E6%98%8E
) 4. [å°å·¥å…·](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E5%B0%8F%E5%B7%A5%E5%85%B7) 

æ­¤ç¨‹å¼ç‚ºbetaç‰ˆï¼Œè‹¥æ–¼ä½¿ç”¨ä¸­æœ‰ç–‘å•æˆ–å»ºè­°ï¼Œå¯ä»¥æ–¼[æ„è¦‹å›é¥‹](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E6%84%8F%E8%A6%8B%E5%9B%9E%E9%A5%8B)æä¾›çµ¦æˆ‘å€‘ï¼Œæˆ‘å€‘å°‡æœƒå°æ­¤æ¡†æ¶é€²è¡Œèª¿æ•´ã€‚
å¦å¤–ï¼Œåœ¨æŠŠå¯¦é©—ç´å…¥æ­¤æ¡†æ¶çš„éç¨‹ä¸­ï¼Œéº»ç…©ä¹Ÿå¹«æˆ‘å€‘å¡«å¯«[å¯¦é©—ç´€éŒ„è¡¨](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E5%AF%A6%E9%A9%97%E8%A8%98%E9%8C%84%E8%A1%A8)ï¼Œå·²æ–¹ä¾¿æˆ‘å€‘è¿½è¹¤é€²åº¦ã€‚

## ç›®éŒ„: 

- [ç°¡ä»‹](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E7%B0%A1%E4%BB%8B)
- [è³‡æ–™å¤¾æ¶æ§‹](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E8%B3%87%E6%96%99%E5%A4%BE%E6%9E%B6%E6%A7%8B)
- [å¯¦é©—åŸ·è¡Œæ–¹æ³•](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E5%AF%A6%E9%A9%97%E5%9F%B7%E8%A1%8C%E6%96%B9%E6%B3%95)
    - [Step 1: å®‰è£dependencies](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-1-%E5%AE%89%E8%A3%9Ddependencies)
    - [Step 2: ä¸‹è¼‰åŸå§‹è³‡æ–™](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-2-%E4%B8%8B%E8%BC%89%E5%8E%9F%E5%A7%8B%E8%B3%87%E6%96%99)
    - [Step 3: æ¸¬è©¦å¯¦é©—æ˜¯å¦å¯åŸ·è¡Œ](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-3-%E6%B8%AC%E8%A9%A6%E5%AF%A6%E9%A9%97%E6%98%AF%E5%90%A6%E5%8F%AF%E5%9F%B7%E8%A1%8C)
    - [Step 4: å»ºæ§‹æ–°å¯¦é©—](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-4-%E5%BB%BA%E6%A7%8B%E6%96%B0%E5%AF%A6%E9%A9%97)
        - [1) å¯¦é©—æ¨¡çµ„](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#1-%E5%AF%A6%E9%A9%97%E6%A8%A1%E7%B5%84-experiment_modulepy)
        - [2) æ¨¡å‹](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#2-%E6%A8%A1%E5%9E%8B-modelpy)
        - [3) å‰è™•ç†](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#3-%E8%B3%87%E6%96%99%E5%89%8D%E8%99%95%E7%90%86-dataset_builderpypreprocesspy)
    - [Step 5: åŸ·è¡Œæ–°å¯¦é©—](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-5-%E5%9F%B7%E8%A1%8C%E6%96%B0%E5%AF%A6%E9%A9%97)
        -  [1) å¯¦é©—Debug](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#1-%E5%AF%A6%E9%A9%97debug)
        -  [2) æ¨¡å‹è¨“ç·´èˆ‡æ¸¬è©¦](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#2-%E6%A8%A1%E5%9E%8B%E8%A8%93%E7%B7%B4%E8%88%87%E6%B8%AC%E8%A9%A6)
        -  [3) TensorBoard-è¨“ç·´æˆæ•ˆç›£æ§](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#3-tensorboard-%E8%A8%93%E7%B7%B4%E6%88%90%E6%95%88%E7%9B%A3%E6%8E%A7)
        -  [4) CPU/GPUåŠ é€Ÿ](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#4-gpucpu%E5%8A%A0%E9%80%9F)
- [ç¯„ä¾‹æª”èªªæ˜](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E7%AF%84%E4%BE%8B%E6%AA%94%E8%AA%AA%E6%98%8E)
- [å°å·¥å…·](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E5%B0%8F%E5%B7%A5%E5%85%B7)
- [å¯¦é©—ç´€éŒ„è¡¨](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E5%AF%A6%E9%A9%97%E8%A8%98%E9%8C%84%E8%A1%A8)
- [æ„è¦‹å›é¥‹](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#%E6%84%8F%E8%A6%8B%E5%9B%9E%E9%A5%8B)


# è³‡æ–™å¤¾æ¶æ§‹ 

ä»¥ä¸‹ç‚ºè³‡æ–™å¤¾æ¶æ§‹ï¼Œæ¨™ä¸Š * çš„æª”æ¡ˆç‚ºå¯¦é©—åŸ·è¡Œå¾Œï¼Œæ‰æœƒç”Ÿæˆçš„æª”æ¡ˆæˆ–è³‡æ–™å¤¾ï¼›æ¨™ä¸Š V çš„ç‚ºç‰¹å®šå¯¦é©—å°ˆå±¬ä¹‹å¯¦é©—æª”æˆ–æª”æ¡ˆå¤¾ï¼›

æ¨™ä¸ŠğŸŸ ç‚ºé ˆç”±å¯¦é©—è€…[è‡ªè¡Œå»ºç½®](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-4-%E5%BB%BA%E6%A7%8B%E6%96%B0%E5%AF%A6%E9%A9%97)ä¹‹å¯¦é©—æª”æˆ–è³‡æ–™å¤¾ï¼›æ¨™ä¸ŠğŸŸ¢ç‚ºé ˆåŸ·è¡Œä¹‹æª”æ¡ˆï¼ŒåŒ…å«[æª”æ¡ˆä¸‹è¼‰](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-2-%E4%B8%8B%E8%BC%89%E5%8E%9F%E5%A7%8B%E8%B3%87%E6%96%99)èˆ‡[å¯¦é©—é‹è¡Œ](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-5-%E5%9F%B7%E8%A1%8C%E6%96%B0%E5%AF%A6%E9%A9%97)ï¼›æ¨™ä¸ŠğŸ”µç‚ºé ˆ[è‡ªè¡Œä¸‹è¼‰](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#step-2-%E4%B8%8B%E8%BC%89%E5%8E%9F%E5%A7%8B%E8%B3%87%E6%96%99)ä¹‹æª”æ¡ˆã€‚

```
.
â”œâ”€â”€ data                                                 # å¯¦é©—è³‡æ–™
|    â”œâ”€â”€ source                                            # å­˜æ”¾åŸå§‹è³‡æ–™ 
|    |      â”œâ”€â”€ ğŸŸ¢download_data_from_google_drive.ipynb      # å¾google_dirveä¸‹è¼‰åŸå§‹è³‡æ–™ç”¨
|    |      â”œâ”€â”€ ğŸ”µgoogle_drive.json                          # ä¸²æ¥google_driveç”¨çš„api-keysï¼Œä¸‹è¼‰æ–¹å¼åƒè€ƒ download_data_from_google_drive.ipynb
|    |      â”œâ”€â”€ ğŸ”µsample_chid.txt                            # åŸå§‹è³‡æ–™
|    |      â”œâ”€â”€ ğŸ”µsample_idx_map.npy                         # åŸå§‹è³‡æ–™
|    |      â”œâ”€â”€ ğŸ”µsample_zip_if_cca_cdtx0001_hist.csv        # ...
|    |      â”œâ”€â”€ ğŸ”µsample_zip_if_cca_cust_f.csv               # ...
|    |      â””â”€â”€ ğŸ”µsample_zip_if_cca_y.csv                    # åŸå§‹è³‡æ–™ 
|    | 
|    â”œâ”€â”€ * sample                                        # å­˜æ”¾åŸå§‹è³‡æ–™downsampleå¾Œçš„è³‡æ–™
|    | 
|    â”œâ”€â”€ *V [experiment_group_name]                      # å­˜æ”¾ç‰¹å®šé¡å‹çš„å¯¦é©—(e.g., rnn)æ‰€éœ€ä¹‹è³‡æ–™
|    |      â”œâ”€â”€ * tmp                                      # ä¸­ç¹¼æª”
|    |      â””â”€â”€ * result                                   # çµæœæª”
|    â”œâ”€â”€ *V [experiment_name]                            # å­˜æ”¾ç‰¹å®šå¯¦é©—(e.g., ex1)ç”¨è³‡æ–™
|    |      â”œâ”€â”€ * tmp                                      # ä¸­ç¹¼æª”
|    |      â””â”€â”€ * result                                   # çµæœæª”
|    â”œâ”€â”€ *V [experiment_name]                            
|    â””â”€â”€ ... 
|
â”œâ”€â”€ common                                               # å…±ç”¨æ¨¡çµ„           
|    â”œâ”€â”€ ETLBase.py                                        # å‰è™•ç†ç”¨å°å·¥å…· 
|    â”œâ”€â”€ utils.py                                          
|    â”œâ”€â”€ pl_module.py                                    # å…§å«å¤šä»»å‹™å¯¦é©—å…±ç”¨ä¹‹æŠ½è±¡æ¨¡çµ„ 
|    â””â”€â”€ __init__.py 
|    
â”œâ”€â”€ experiments                                          # V å¯¦é©—æ¨¡çµ„ 
|    â”œâ”€â”€VğŸŸ [experiment_name]                              # V ç‰¹å®šå¯¦é©—ä¹‹å¯¦é©—æ¨¡çµ„ 
|    |      â”œâ”€â”€VğŸŸ experiment_module.py                    # V å¯¦é©—è¨­å®šæ¨¡çµ„                                
|    |      â”œâ”€â”€VğŸŸ model.py                                # V æ¨¡å‹æ¨¡çµ„ 
|    |      â”œâ”€â”€VğŸŸ dataset_builder.py                      # V è³‡æ–™å‰è™•ç†æ¨¡çµ„ 
|    |      â”œâ”€â”€VğŸŸ preprocess.py                           # V è³‡æ–™å‰è™•ç†æ¨¡çµ„ 
|    |      â””â”€â”€VğŸŸ __init__.py                        
|    â””â”€â”€VğŸŸ [experiment_name]
|    â””â”€â”€ ...
|
â”œâ”€â”€ *checkpoint                                          # å„²å­˜æ¨¡å‹æš«å­˜æª” 
|    â”œâ”€â”€ *V [experiment_name]                              # å„²å­˜ç‰¹å®šå¯¦é©—çš„æ¨¡å‹æš«å­˜æª”
|    |      â”œâ”€â”€ *V epoch964-loss0.00.ckpt                    # V æœ€ä½³æ¨¡å‹çš„æš«å­˜æª”
|    |      â””â”€â”€ *V last.ckpt                                 # V æœ€å¾Œä¸€å€‹epochçš„æ¨¡å‹æš«å­˜æª”   
|    â”œâ”€â”€ *V [experiment_name]
|    â””â”€â”€ ... 
|
â”œâ”€â”€ *logs                                                # å­˜æ”¾è¨“ç·´LOG: å„ä»»å‹™by-iterationçš„æˆæ•ˆã€å¯¦é©—åƒæ•¸ã€æ¨¡å‹æ¶æ§‹åœ– 
|    â””â”€â”€ tensorboard 
|           â”œâ”€â”€ *V [experiment_name]                       # å„²å­˜ç‰¹å®šå¯¦é©—çš„LOG 
|           |       â”œâ”€â”€ *V version_0                         # å„²å­˜ç¬¬1æ¬¡å¯¦é©—çš„LOG 
|           |       â”œâ”€â”€ *V version_1                         # å„²å­˜ç¬¬2æ¬¡å¯¦é©—çš„LOG 
|           |       â””â”€â”€ ... 
|           â”œâ”€â”€ *V [experiment_name]                      
|           â””â”€â”€ ... 
â”œâ”€â”€ğŸŸ¢run_project.py                                      # å¯¦é©—åŸ·è¡Œæª” 
â”œâ”€â”€ requirements.txt 
â””â”€â”€ ReadMe.md 
```



# å¯¦é©—åŸ·è¡Œæ–¹æ³• 

## Step 1: å®‰è£dependencies 

é¦–å…ˆå°‡ç›¸é—œå¥—ä»¶é€²è¡Œå®‰è£ã€‚

åŸ·è¡Œ: 
`sh install_packages.sh`

æˆ–:
```
pip install -r requirements.txt
```

æˆ–: 

```
pip install google-api-python-client==2.5.0
pip install oauth2client==4.1.3

pip install numpy==1.18.5
pip install pandas==1.1.4
pip install tqdm==4.54.1
pip install feather-format==0.4.1
pip install tables==3.6.1

pip install sklearn==0.0
pip install torch==1.8.1

pip install torchmetrics==0.3.2
pip install pytorch-lightning==1.3.2
pip install lightning-bolts==0.3.3

pip install tensorboard==2.4.0
```
è‹¥è¦ä½¿ç”¨Nvidia GPUï¼Œé ˆå®‰è£GPUç‰ˆæœ¬pytorchï¼Œè©³æƒ…è«‹è¦‹ï¼šhttps://pytorch.orgã€‚


## Step 2: ä¸‹è¼‰åŸå§‹è³‡æ–™ 

* æ–¹æ³•ä¸€: è‡³data/sourceåŸ·è¡Œ**download_data_from_google_drive.ipynb**é€²è¡Œä»¥ä¸‹åŸå§‹è³‡æ–™çš„ä¸‹è¼‰
```
ğŸ”µsample_chid.txt                            # åŸå§‹è³‡æ–™
ğŸ”µsample_idx_map.npy                         # åŸå§‹è³‡æ–™
ğŸ”µsample_zip_if_cca_cdtx0001_hist.csv        # ...
ğŸ”µsample_zip_if_cca_cust_f.csv               # ...
ğŸ”µsample_zip_if_cca_y.csv                    # åŸå§‹è³‡æ–™ 
```



* æ–¹æ³•äºŒ: è‡ªè¡Œä¸‹è¼‰ä»¥ä¸Šè³‡æ–™è‡³data/sourceã€‚

è‹¥æ¡ç”¨æ–¹æ³•ä¸€ï¼Œé ˆè‡³google developer platformä¸‹è¼‰ğŸ”µgoogle_drive.jsonï¼Œä¸²æ¥google_driveç”¨çš„api-keysï¼Œä¸‹è¼‰æ–¹å¼åƒè€ƒ download_data_from_google_drive.ipynbã€‚

## Step 3: æ¸¬è©¦å¯¦é©—æ˜¯å¦å¯åŸ·è¡Œ 

åŸ·è¡ŒFastDebug: 
`python run_project.py -m fastdebug -e ex1` 


æ­¤ç¨‹å¼æœƒå°experiments/ex1è³‡æ–™å¤¾æ‰€å®šç¾©ä¹‹å¯¦é©—é€²è¡Œdebugã€‚éç¨‹ä¸­æœƒå°åŸå§‹è³‡æ–™é€²è¡Œå‰è™•ç†ï¼Œä¸¦å°‡çµæœèˆ‡ä½”å­˜æª”å„²å­˜æ–¼`data/sample`ã€`data/rnn/tmp`ã€`data/rnn/result`ã€`data/ex1/tmp`ã€`data/ex1/result`ï¼Œæ¥è‘—ï¼Œè³‡æ–™è™•ç†å®Œå¾Œï¼Œå°±æœƒé€²è¡Œ1å€‹stepçš„trainingå’Œvalidationï¼Œä»¥å¿«é€Ÿé©—è­‰æ¨¡å‹ã€ç¨‹å¼çš„é‹ä½œæ­£å¸¸ã€‚

## Step 4: å»ºæ§‹æ–°å¯¦é©—: 

å¯ä»¥è¤‡è£½ex1è³‡æ–™å¤¾ï¼Œå¿…å°‡å…¶æ”¹ç‚ºå¯¦é©—è€…æ¬²å‘½åçš„å¯¦é©—åç¨±ï¼ˆe.g., ex2)ï¼Œä¸¦ä¿®æ”¹å…¶ä¸­çš„`experiment_module.py`/`model.py`/`dataset_builder.py`/`preprocess.py`ã€‚å…¶ä¸­`experiment_module.py`ç‚ºå¯¦é©—æ¨¡çµ„ï¼Œ`model.py`ç‚ºæ¨¡å‹ï¼Œ`dataset_builder.py`å’Œ`preprocess.py`ç‚ºå‰è™•ç†ç¨‹å¼ã€‚

ä»¥ä¸‹å°‡ä»¥ex1ç‚ºç¯„ä¾‹ï¼Œåˆ†åˆ¥èªªæ˜æ­¤ä¸‰é¡ç¨‹å¼çš„å»ºæ§‹æ–¹å¼: 

### 1) å¯¦é©—æ¨¡çµ„ (`experiment_module.py`)

å¯¦é©—æ¨¡çµ„å¿…é ˆåŒ…å«ä¸‰å€‹Class: `ExperimentConfig`ã€`ExperimentalMultiTaskDataModule`å’Œ`ExperimentalMultiTaskModule`ï¼Œ`ExperimentConfig`å®šç¾©äº†å¯¦é©—åç¨±ã€å¯¦é©—åƒæ•¸ã€ä»¥åŠæœ€ä½³æ¨¡å‹çš„æš«å­˜æª”åç¨±ï¼Œ`ExperimentalMultiTaskDataModule`å®šç¾©äº†è³‡æ–™å‰è™•ç†ã€è¨“ç·´ä»¥åŠæ¸¬è©¦è³‡æ–™ï¼Œ`ExperimentalMultiTaskModule`å®šç¾©äº†å¤šä»»å‹™æ¨¡å‹ã€ä»»å‹™åç¨±ã€ä»»å‹™ç›®æ¨™å‡½æ•¸ä»¥åŠä»»å‹™æˆæ•ˆè¡¡é‡æŒ‡æ¨™ã€‚

ä»¥ä¸‹å°‡é‡å°æ’°å¯«æ–¹å¼é€²ä¸€æ­¥èªªæ˜: 

**1. ExperimentConfig**:
```python 

class ExperimentConfig:
    # @ExperimentDependent 
    best_model_checkpoint = 'epoch07-loss0.00.ckpt' # æœ€ä½³æ¨¡å‹çš„æš«å­˜æª”åç¨±

    name = experiment_name  # å¯¦é©—åç¨±ï¼Œéœ€å’Œè³‡æ–™å¤¾åç¨±ç›¸åŒ(e.g., ex1) 

    experiment_parameters = {                    # å¯¦é©—åƒæ•¸ 
        "model_parameters": {                      # æ¨¡å‹åƒæ•¸: æœƒæ”¾åˆ°model.pyçš„åƒæ•¸ã€‚
            "data_independent":{                     # å’Œè³‡æ–™ç„¡é—œçš„æ¨¡å‹åƒæ•¸ï¼Œ(e.g., hidden_dims ä¸­é–“å±¤ç¶­åº¦, n_layers å±¤æ•¸, ...) 
                'hidden_dims': 64,              
                'n_layers': 2, 
                'cell': 'LSTM', 
                'bi': False
            },
            "data_dependent": {                      # å’Œè³‡æ–™ç›¸é—œä¹‹æ¨¡å‹åƒæ•¸ï¼Œ(e.g., dense_dims è¼¸å…¥ä¹‹æ•¸å€¼å‹ç‰¹å¾µç¶­åº¦, use_chid æ˜¯å¦ä½¿ç”¨é¡§å®¢IDç‚ºç‰¹å¾µ, out_dims æ¨¡å‹è¼¸å‡ºçš„ç¶­åº¦)  
                'dense_dims': dense_dims, 
                'sparse_dims': sparse_dims,
                'use_chid': use_chid, 
                'out_dims': out_dims,
                'class_outputs': class_outputs 
            }
        },
        "training_parameters":{                      # è¨“ç·´åƒæ•¸ï¼Œ(e.g., dropout, warmup_epochs, annealing_cycle_epochs) 
            "dropout": 0.5, 
            "warmup_epochs": 5, 
            "annealing_cycle_epochs": 40
        }
    }
```

* å…¶ä¸­ï¼Œdropout/warmup_epochs/annealing_cycle_epochsè‹¥ä¸æä¾›ï¼Œé æ¸¬å‰‡åˆ†åˆ¥æœƒçµ¦0.5, 5, 40ã€‚warmup_epochså’Œannealing_cycle_epochsæœƒè¼¸å…¥ä»¥ä¸‹learning rate schedulerï¼Œé€²è¡Œlearning rateå‹•æ…‹èª¿æ•´ï¼Œä»¥åŠ é€Ÿæ¨¡å‹è¨“ç·´ã€‚

```python 
LinearWarmupCosineAnnealingLR(optimizer, 
 warmup_epochs=self._warmup_epochs, 
 max_epochs=self._annealing_cycle_epochs 
)
```
**2. ExperimentalMultiTaskDataModule**:


```python 
class ExperimentalMultiTaskDataModule(BaseMultiTaskDataModule):
    # @blockPrinting
    def prepare_data(self):
        self.train_dataset = train_dataset.run()[0] 
        self.test_dataset = test_dataset.run()[0]
```

* æ–¼prepare_dataå®šç¾©train_datasetå’Œtest_datasetã€‚æ­¤å…©å€‹ç‰©ä»¶é ˆç‚ºtorch.utils.dataçš„TensorDatasetç‰©ä»¶ã€‚

**3. ExperimentalMultiTaskModule**:

```python 
import torch.nn.functional as F
class ExperimentalMultiTaskModule(BaseMultiTaskModule):

    def config_model(self, model_parameters, dropout): # æ­¤è™•å¼•å…¥model.pyçš„æœ€top-levelçš„nn.Moduleï¼Œæ­¤nn.Moduleåƒmodel_parameterså’Œdropoutå…©å€‹åƒæ•¸ï¼Œå¾Œé¢å°‡æ–¼model.pyé€²ä¸€æ­¥èªªæ˜å»ºæ§‹æ–¹å¼ã€‚
        return MultiTaskModel(
                model_parameters,
                dropout = dropout
            )
            
    def config_task_names(self):                                 # æ­¤è™•å®šç¾©æ¨¡å‹è¼¸å‡ºæ‰€å°æ‡‰ä¹‹ä»»å‹™åç¨± 
        return ['objmean', 'tscnt', 'label_0']
        
    def config_loss_funcs(self): 
        return [F.mse_loss, F.mse_loss, F.binary_cross_entropy]  # æ­¤è™•å®šç¾©å„ä»»å‹™ä¹‹ç›®æ¨™å‡½æ•¸ 
    
    

    def config_task_metrics(self):                               # æ­¤è™•å®šç¾©å€‹ä»»å‹™ä¹‹è¡¡é‡æŒ‡æ¨™åç¨± 
        return {
            'objmean': ['mse', 'mae'], 
            'tscnt': ['mse', 'mae'], 
            'label_0': ['acc', 'auc']
        }
    
    def config_metric_calculators(self):                         # (optional) å®šç¾©å€‹æŒ‡æ¨™åç¨±æ‰€å°æ‡‰ä¹‹æŒ‡æ¨™è¨ˆç®—å…ƒä»¶ã€‚è‹¥æœ‰æ–°æŒ‡æ¨™(émse/mae/acc/auc)æ‰éœ€å¯¦ä½œæ­¤å‡½æ•¸ã€‚
        from torchmetrics import MeanSquaredError, MeanAbsoluteError, Accuracy, AUROC
        return {
            'mse': lambda: MeanSquaredError(compute_on_step=False), 
            'mae': lambda: MeanAbsoluteError(compute_on_step=False), 
            'acc': lambda: Accuracy(compute_on_step=False),
            'auc': lambda: AUROC(compute_on_step=False, pos_label=1)
        }
    def batch_forward(self, batch):                              # æ­¤è™•æ ¹æ“šæ¨¡å‹çš„forwardæ–¹å¼å®šç¾©ä¸€å€‹batchçš„forwardï¼Œä»¥ä¾›å…±ç”¨æ¨¡çµ„çš„training/validation/testingå°‡ground_truthå’Œoutputså¥—ç”¨åˆ°lossä¸Šã€‚
        x_dense, x_sparse, objmean, tscnt, label_0 = batch
        outputs = self(x_dense, x_sparse)
        ground_truths = objmean, tscnt, label_0
        return outputs, ground_truths
```

### 2) æ¨¡å‹ (`model.py`)

model.pyçš„top-level moduleä¾ç…§nn.Moduleæ—¢æœ‰æ–¹æ³•é€²è¡Œå¯¦ä½œï¼Œä½†é ˆæ³¨æ„__init__éœ€åƒ`model_parameters`å’Œ`dropout`ï¼Œmodel_parametersç‚ºä¸€dictionaryï¼Œ
å…§å®¹ç‚º`ExperimentConfig.experiment_parameters["model_parameters"]` ä¸­`"data_independent"`ä»¥åŠ`"data_dependent"`åº•ä¸‹çš„æ‰€æœ‰åƒæ•¸ã€‚

```python 
class MultiTaskModel(torch.nn.Module):
    def __init__(self, model_parameters, dropout=0.5):
        super(MultiTaskModel, self).__init__()

        # Load parameters: 
        hidden_dims = model_parameters['hidden_dims']
        n_layers = model_parameters['n_layers'] 
        cell = model_parameters['cell'] 
        bi = model_parameters['bi'] 
        dense_dims = model_parameters['dense_dims'] 
        sparse_dims = model_parameters['sparse_dims'] 
        use_chid = model_parameters['use_chid'] 
        out_dims = model_parameters['out_dims'] 
        class_outputs = model_parameters['class_outputs']

        # Build model blocks: 
        self.rnn = ET_Rnn(
            dense_dims, 
            sparse_dims, 
            hidden_dims, 
            n_layers=n_layers, 
            use_chid=use_chid,
            cell=cell, 
            bi=bi, 
            dropout=dropout
        )
        
        self.mlps = nn.ModuleList([
            MLP(
                self.rnn.out_dim, hidden_dims=[self.rnn.out_dim // 2], out_dim=od
            ) for od in out_dims
        ])

        # Parameters used in forward 
        self.class_outputs = class_outputs

    def forward(self, *x):
        x_dense, x_sparse = x 
        logits = self.rnn(x_dense, x_sparse)
        outs = []
        for mlp, is_class in zip(self.mlps, self.class_outputs):
            out = mlp(logits)
            if is_class:
                out = torch.sigmoid(out)
            outs.append(out)
        return outs


```

### 3) è³‡æ–™å‰è™•ç† (`dataset_builder.py`/`preprocess.py`)

æ­¤å…©ç¨‹å¼å®šç¾©äº†ç”¢ç”ŸTensorDatasetç‰©ä»¶ä¹‹è³‡æ–™å‰è™•ç†data pipelineï¼Œå…¶ä½¿ç”¨äº†æˆ‘å€‘çš„`ETLPro`ç‰©ä»¶é€²è¡Œè™•ç†æ¨¡çµ„çš„å®šç¾©ä¸¦é€²è¡Œpipelineçš„ä¸²æ¥ã€‚


æ–¼ä¸åŒçš„å¯¦é©—æˆ–æ¨¡å‹æ‰€éœ€ä¹‹è³‡æ–™å‰è™•ç†æ–¹å¼ä¸ä¸€æ¨£ï¼Œå› æ­¤äº¦å¯ä»¥è‡ªè¡Œå‰µå»ºè‡ªå·±çš„è³‡æ–™å‰è™•ç†æ–¹å¼ã€‚è©³ç´°ä½¿ç”¨æ–¹å¼å°‡æ–¼**ç¯„ä¾‹æª”ä»‹ç´¹**èªªæ˜ï¼Œ`ETLPro`çš„ä½¿ç”¨æ–¹å¼å‰‡æœƒæ–¼**å°å·¥å…·**ä»‹ç´¹ã€‚


## Step 5: åŸ·è¡Œæ–°å¯¦é©—: 

ç•¶æ–°çš„å¯¦é©—å»ºæ§‹å®Œæˆï¼Œå»ºè­°ä¾ä»¥ä¸‹é †åºé€²è¡Œdebugèˆ‡è¨“ç·´: 

### 1) å¯¦é©—Debug:

**fastdebug**

é¦–å…ˆï¼ŒåŸ·è¡Œfastdebugï¼Œç¢ºä¿å³ä½¿æ¨¡å‹èˆ‡å¯¦é©—è¨­å®šä¿®æ”¹å¾Œï¼Œè¨“ç·´èˆ‡é©—è­‰çš†èƒ½é †åˆ©åŸ·è¡Œ: 

`python run_project.py -m fastdebug -e [å¯¦é©—è³‡æ–™å¤¾åç¨±]` 

**fit1batch** 

æ¥è‘—ï¼Œç‚ºäº†ç¢ºä¿æ¨¡å‹è¨­è¨ˆæ˜¯åˆç†çš„ï¼Œè®“æ¨¡å‹overfitä¸€å€‹è¨“ç·´çš„batchï¼Œæ­£å¸¸çš„ç‹€æ³ï¼Œlossè¦èƒ½å¤ æŒçºŒä¸‹é™ï¼Œlossçš„ç›£æ§åƒè€ƒ [TensorBoard-è¨“ç·´æˆæ•ˆç›£æ§](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#3-tensorboard-%E8%A8%93%E7%B7%B4%E6%88%90%E6%95%88%E7%9B%A3%E6%8E%A7)ã€‚

`python run_project.py -m fit1batch -e [å¯¦é©—è³‡æ–™å¤¾åç¨±] (-l [log_dir])` 

åŸ·è¡Œéç¨‹ä¸­ï¼Œæœƒå­˜æ”¾TensorBoardçš„Logæ–¼è³‡æ–™å¤¾`./logs/tensorboard/[å¯¦é©—è³‡æ–™å¤¾åç¨±]/version_[x]`ã€‚

### 2) æ¨¡å‹è¨“ç·´èˆ‡æ¸¬è©¦

**train** 

åŸ·è¡Œè¨“ç·´: 

`python run_project.py -m train -e [å¯¦é©—è³‡æ–™å¤¾åç¨±] (-l [log_dir])`  

æ¨¡å‹çš„validation/training performanceçš„ç›£æ§åƒè€ƒ [TensorBoard-è¨“ç·´æˆæ•ˆç›£æ§](https://github.com/udothemath/ncku_customer_embedding/blob/multitask_experiment_framework/README.md#3-tensorboard-%E8%A8%93%E7%B7%B4%E6%88%90%E6%95%88%E7%9B%A3%E6%8E%A7)ã€‚

è¨“ç·´éç¨‹ä¸­ï¼Œè¡¨ç¾æœ€ä½³çš„æ¨¡å‹ä»¥åŠæœ€å¾Œä¸€å€‹epochçš„æ¨¡å‹æš«å­˜æª”(.ckpt)æœƒè¢«ä¿å­˜æ–¼`./checkpoint/[å¯¦é©—è³‡æ–™å¤¾åç¨±]`ä¸­ï¼Œæ¯å¢åŠ ä¸€å€‹epochï¼Œå°±æœƒè¢«æ›´æ–°ä¸€æ¬¡ã€‚

**test**

è‹¥è¦ç”¨æ¸¬è©¦è³‡æ–™æª¢æ¸¬æ¨¡å‹çš„æœ€çµ‚çµæœï¼Œå¯ä»¥å°‡`./checkpoint/[å¯¦é©—è³‡æ–™å¤¾åç¨±]`ä¸­ï¼Œæœ€ä½³æ¨¡å‹çš„.ckptæª”æŒ‡å®šçµ¦`experiment_module.py`ä¸­`ExperimentConfig`çš„`best_model_checkpoint`åƒæ•¸ï¼Œæ¥è‘—åŸ·è¡Œ: 

`python run_project.py -m test -e [å¯¦é©—è³‡æ–™å¤¾åç¨±]`

### 3) TensorBoard-è¨“ç·´æˆæ•ˆç›£æ§ 

æ–¼terminalè¼¸å…¥`tensorboard --logdir logs/tensorboard/[å¯¦é©—è³‡æ–™å¤¾åç¨±]`ï¼Œå³å¯æ–¼ç€è¦½å™¨é–‹å•ŸTensorBoardæŸ¥çœ‹è¨“ç·´ç‹€æ³(http://localhost:6006/ )ã€‚

* _Note: _è‹¥æ˜¯åŸ·è¡Œfit1batchï¼Œå…¶ä¸­valçš„åœ–è¡¨é¡¯ç¤ºçš„ç‚ºåœ¨ä¸€å€‹è¨“ç·´çš„batchä¸Šè¡¡é‡çš„æˆæ•ˆã€‚

è‹¥è¦ä¿®æ”¹logè³‡æ–™å¤¾ï¼Œå¯ä»¥æ–¼åŸ·è¡Œæ™‚ï¼Œç”¨`-l`æŒ‡å®šæ–°logè³‡æ–™å¤¾è·¯å¾‘ï¼Œe.g., 

`python run_project.py -m [fit1batch/train] -e [å¯¦é©—è³‡æ–™å¤¾åç¨±] -l MyDirectory`ï¼Œæ­¤æ™‚ï¼Œå‰‡æ–¼terminalè¼¸å…¥`tensorboard --logdir MyDirectory/[å¯¦é©—è³‡æ–™å¤¾åç¨±]`ï¼Œå³å¯æŸ¥çœ‹è©²å¯¦é©—çµæœã€‚

è‹¥æœ‰é€²è¡Œå¯¦é©—åƒæ•¸èª¿æ•´ï¼Œå¯æ–¼ http://localhost:6006/#hparams æŸ¥çœ‹å„å¯¦é©—åƒæ•¸ä¸‹çš„æ¨¡å‹æˆæ•ˆã€‚

### 4) GPU/CPUåŠ é€Ÿï¼š

è‡³`run_project.py`è¨­å®š: 

1. `pin_memory=True` 
2. `num_workers`ç‚ºCPUæ•¸é‡ 
3. `gpus`ç‚ºgpuæ•¸é‡ã€‚


# ç¯„ä¾‹æª”èªªæ˜


# å°å·¥å…· 

## ETLPro 

## utils.blockPrint


# å¯¦é©—è¨˜éŒ„è¡¨
|å¯¦é©—åç¨±|æ¨¡å‹åç¨±|ä»»å‹™ä¸­è‹±åç¨±|å·²å»ºæ§‹å®Œæˆå¯¦é©—è³‡æ–™å¤¾|fastdebugé‹ä½œç„¡èª¤|fit1batché‹ä½œç„¡èª¤|GPUæˆåŠŸåŠ é€Ÿ|trainé‹ä½œç„¡èª¤|åƒæ•¸èª¿æ•´å®Œæˆ|æœ€ä½³æ¨¡å‹testç„¡èª¤|æœ€ä½³æ¨¡å‹.ckptè·¯å¾‘|è² è²¬äºº|
|--|:--:|--|--|--|--|--|--|--|--|--|--|
|ex1|ETRNN|ä¸‹æœˆæ¶ˆè²»ç¸½é‡‘é¡(objmean)ã€ä¸‹æœˆæ¶ˆè²»æ¬¡æ•¸(tscnt)ã€ä¸‹æœˆæ˜¯å¦æ¶ˆè²»(label_0)|V|V|V| |V| | | |ç‰å±±åœ˜éšŠ|
|ex2|ETRNN|ä¸‹æœˆæ¶ˆè²»ç¸½é‡‘é¡(objmean)ã€ä¸‹æœˆæ¶ˆè²»æ¬¡æ•¸(tscnt)ã€ä¸‹æœˆæ˜¯å¦æ¶ˆè²»(label_0)|V| | | | | | | |ç‰å±±åœ˜éšŠ|
|ex3|TemDMGE|ä¸‹æœˆä½¿ç”¨ç´…åˆ©(bnsfg)ã€ä¸‹æœˆä½¿ç”¨åˆ†æœŸ(iterm)ã€ä¸‹æœˆæ¶ˆè²»å•†åº—(stonc_label)-cross doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex4|TemDMGE_shared|ä¸‹æœˆä½¿ç”¨ç´…åˆ©(bnsfg)ã€ä¸‹æœˆä½¿ç”¨åˆ†æœŸ(iterm)ã€ä¸‹æœˆæ¶ˆè²»å•†åº—(stonc_label)-cross doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex5|TemGCN|ä¸‹æœˆä½¿ç”¨ç´…åˆ©(bnsfg)-single doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex6|TemGCN|ä¸‹æœˆä½¿ç”¨åˆ†æœŸ(iterm)-single doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex7|TemGCN|ä¸‹æœˆæ¶ˆè²»å•†åº—(stonc_label)-single doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex8|GCN_RNN|ä¸‹æœˆä½¿ç”¨ç´…åˆ©(bnsfg)-single doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex9|GCN_RNN|ä¸‹æœˆä½¿ç”¨åˆ†æœŸ(iterm)-single doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|
|ex10|GCN_RNN|ä¸‹æœˆæ¶ˆè²»å•†åº—(stonc_label)-single doamin|| | | | | | | |æˆå¤§åœ˜éšŠ|

# æ„è¦‹å›é¥‹ 

- [1] GNNæ¨¡å‹è¼¸å…¥è³‡æ–™çš„æ–¹å¼èˆ‡å…ˆå‰ETRNNçš„ä½¿ç”¨dataloaderçš„æ–¹å¼ä¸åŒ (static graphå¯ä¸ä½¿ç”¨data loaderã€dynamic graphä»¥æ¯æœˆçš„snapshotsä½œç‚ºä¸åŒçš„graph)
- [2] Multitaskå¦‚æœæ˜¯ä½œç‚ºè¨“ç·´ä»»å‹™ä¾†å¯¦ç¾çš„è©±ï¼Œæ¯å€‹ä»»å‹™æœƒæœ‰ä¸åŒçš„loss(Recallã€AUC)ï¼Œä¸ç¢ºå®šç´€éŒ„è¨“ç·´éç¨‹æ˜¯å¦å¯ä»¥åŒæ™‚è¨˜éŒ„å¤šä»»å‹™çš„loss
- 
-  


# Old ReadMe: 

## åŸå§‹ç¨‹å¼ç¢¼
```diff
! Under Construction !
```

You can check the latest sources with the command:
```
git clone git@github.com:udothemath/ncku_customer_embedding.git
```

## å®‰è£dependencies: 

```
sh install_packages.sh
```

### ToDo: add package version
```
pip install google-api-python-client==2.5.0
pip install oauth2client==4.1.3

pip install numpy==1.18.5
pip install pandas==1.1.4
pip install tqdm==4.54.1
pip install feather-format==0.4.1
pip install tables==3.6.1

pip install sklearn==0.0
pip install torch==1.8.1

pip install torchmetrics==0.3.2
pip install pytorch-lightning==1.3.2
pip install lightning-bolts==0.3.3

pip install tensorboard==2.4.0
```

## å¦‚ä½•è¨­å®šèˆ‡åŸ·è¡Œ? 

### 1. Download Dataset from Google Drive 
* è‡³../dataåŸ·è¡Œ**download_data_from_google_drive.ipynb**é€²è¡Œè¨“ç·´èˆ‡æ¸¬è©¦è³‡æ–™ä¸‹è¼‰

### 2. Preprocessing and Build TensorDataset 

* å…ˆè‡³../esunåº•ä¸‹
* åˆ†æ®µåŸ·è¡Œ
  * `python preprocess.py`: å°‡../dataçš„è³‡æ–™é€²è¡Œdownsamplingå’Œè³‡æ–™è™•ç†è½‰æ›ï¼Œä¸¦å°‡çµæœå„²å­˜æ–¼../esun/data/resultã€‚
  * `python dataset_builder.py`: å°‡preprocess.pyçš„çµæœé€²ä¸€æ­¥è½‰æ›ç‚ºæ¨¡å‹æ‰€éœ€ä¹‹æ ¼å¼(i.e., TensorDataset)ã€‚
* ç›´æ¥åŸ·è¡Œ
  * `python dataset_builder.py`

### 3. å»ºç«‹loggingèˆ‡checkpointè·¯å¾‘

1.  å»ºç«‹**logs/tensorboard**è·¯å¾‘ï¼Œä¸¦æ–¼å…¶ä¸­å»ºç«‹ncku_customer_embeddingè³‡æ–™å¤¾ï¼Œä»¥å„²å­˜å¯¦é©—ç”¢ç”Ÿä¹‹Tensorboard Logsã€‚
2.  å»ºç«‹**checkpoint**è³‡æ–™å¤¾ï¼Œä»¥å„²å­˜æ¨¡å‹æš«å­˜æª”ã€‚
3.  æ‰“é–‹../esunåŸ·è¡Œ**run_project.py**é€²è¡Œç·¨è¼¯ã€‚
    - å°‡TensorBoardLogger('/home/ai/work/logs/tensorboard',...)ä¸­çš„tensorboardè·¯å¾‘æ”¹ç‚ºStep 1æ‰€å‰µå»ºçš„**logs/tensorboardè·¯å¾‘**ã€‚
    - å°‡ModelCheckpoint(... dirpath='./checkpoint',...)ä¸­çš„dirpathè·¯å¾‘æ”¹ç‚ºStep 2çš„**checkpointè·¯å¾‘**

### 4. åŸ·è¡Œæ¨¡å‹è¨“ç·´ã€Debugæˆ–é©—è­‰

* è¨“ç·´: `python run_project.py -m train`
* Debug: 
  - `python run_project.py -m fastdebug` (å¿«é€ŸåŸ·è¡Œä¸€æ¬¡validation_stepå’Œtrain_step)
  - `python run_project.py -m fit1batch` ([è®“æ¨¡å‹overfitä¸€å€‹batch](https://www.youtube.com/watch?v=nAZdK4codMk)) 
* é©—è­‰: 
  - `python run_project.py -m test` (ä½¿ç”¨æ¸¬è©¦è³‡æ–™é€²è¡Œæ¸¬è©¦) 


## å¦‚ä½•ç›£æ§è¨“ç·´ç‹€æ³? 

- æ–¼terminalè¼¸å…¥`tensorboard --logdir [tensorboard/ncku_customer_embeddingè·¯å¾‘]`ï¼Œå³å¯æ–¼ç€è¦½å™¨é–‹å•ŸtensorboardæŸ¥çœ‹è¨“ç·´ç‹€æ³(http://localhost:6006/)ã€‚


## é‡è¦ç¨‹å¼è¨­å®šèªªæ˜ 

### Downsampling: 

ç‚ºäº†åŠ é€Ÿæ¸¬è©¦ï¼Œ**preprocess.py**åšè³‡æ–™è™•ç†éç¨‹ä¸­ï¼Œæœƒé€²ä¸€æ­¥downsampleè‡³500åusersï¼Œå°‡**preprocess.py**ä¸­é€²è¡Œä»¥ä¸‹ä¿®æ”¹ï¼Œå³å¯è€ƒæ…®æ‰€æœ‰(50K)çš„usersã€‚

å°‡
```python
sampled_chids = Sample_chids(
                      'sample_chids', 
                      [chids], 
                      result_dir = os.path.join(sample_path,'sampled_chids.npy'), 
                      n_sample = 500
           ) 
```
æ”¹ç‚º
```python
sampled_chids = Sample_chids(
                      'sample_chids', 
                      [chids], 
                      result_dir = os.path.join(sample_path,'sampled_chids.npy'), 
                      n_sample = None
           ) 
```
### å¦‚ä½•ä¿®æ”¹æ¨¡å‹åƒæ•¸? 

è‡³run_project.pyä¿®æ”¹: 
```python
config = {
           'hidden_dims': 64, 
           'n_layers': 2, 
           'cell': 'LSTM', 
           'bi': False, 
           'dropout': 0.5
}
``` 

è‡³dataset_builder.pyä¿®æ”¹`dense_feat`ã€`sparse_feat`å’Œ`USE_CHID`ä»¥æ±ºå®šæ¨¡å‹æ‰€ä½¿ç”¨çš„**é¡åˆ¥å‹ç‰¹å¾µ**ã€**æ•¸å€¼å‹ç‰¹å¾µ**ä»¥åŠ**æ˜¯å¦ä½¿ç”¨é¡§å®¢idåšç‚ºé¡åˆ¥å‹ç‰¹å¾µ**ã€‚

### å¦‚ä½•ä½¿preprocess.pyèªåˆ¥å…¶ä½¿ç”¨æª”æ¡ˆçš„å„²å­˜è·¯å¾‘ä»¥åŠå…¶ç”¢ç”Ÿçš„æª”æ¡ˆä¹‹å„²å­˜è·¯å¾‘? 

å¯å°‡ä»¥ä¸‹preprocess.pyçš„è·¯å¾‘é€²è¡Œèª¿æ•´ï¼Œ`origin_path`æ˜¯ä¾†æºè³‡æ–™çš„è·¯å¾‘ã€`sample_path`æ˜¯å„²å­˜ä¾†æºè³‡æ–™çš„ä¸€å€‹downsampleçš„ç‰ˆæœ¬çš„è·¯å¾‘ã€`tmp_path`å„²å­˜preprocesséç¨‹ä¸­ä¸­ç¹¼æª”çš„è·¯å¾‘ã€`result_path`å„²å­˜æœ€çµ‚æª”æ¡ˆçš„è·¯å¾‘ã€‚

```python
origin_path = '../data'
sample_path = 'data/sample'
tmp_path = 'data/tmp'
result_path = 'data/result'
chid_file = os.path.join(origin_path, 'sample_chid.txt')
cdtx_file = os.path.join(origin_path, 'sample_zip_if_cca_cdtx0001_hist.csv')
cust_f_file = os.path.join(origin_path, 'sample_zip_if_cca_cust_f.csv')
```

## Test
Add my comment
